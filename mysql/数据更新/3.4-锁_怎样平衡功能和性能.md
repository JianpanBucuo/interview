# 锁\_怎样平衡功能和性能

## MYSQL 锁的种类

- 按照粒度分， mysql 锁可以分为 全局锁，表级锁，行锁

- 全局锁会锁住左右表，整个库无法修改
- 表级锁分为表锁（数据锁）和元数据锁
- 行锁会锁住数据行，分为共享锁和独占锁

### 全局锁

- FTWRL (flush tables with read lock)
- 此命令使整个库处于只读状态
- 主要用途是保证备份的一致性
- 不要随意使用，杀伤性极大，要在备库使用

### 表锁（数据锁）

- lock tables [table] read/write
- 表锁是非常重的锁，在 Innodb 中使用很少

### 元数据锁（metadata lock）

- 元数据指的是表的结构，字段，数据类型，索引
- 事务访问数据时，会自动给表加 MDL 读锁
- 事务修改元数据时，会自动给表加 MDL 写锁

### 行锁

- 行锁也有两种类型
- 读锁（共享锁） S 锁
- 写锁（排它锁/独占锁）X 锁

- S 锁不是不让读，而是自己要读，不让别人写
- X 锁不只是不让写，而是自己要写，不让别人读写
- `只有 S 锁和 S 锁之间可以兼容，其他均不兼容`

加了 X 锁，
别人用了快照可以读写

## 总结

- 锁是 MYSQL 高效执行事务的必备基础
- 锁会引发很多的性能问题，可能造成等待和死锁
- 锁还会引发很多的 功能问题，如脏读和不可重复读等
