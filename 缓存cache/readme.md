### Cache 缓存

#### 强制缓存

当客户端请求后，会先访问缓存数据库看缓存是否存在。如果存在则直接返回，不存在则请求服务器，响应后再写入缓存数据库。
`强制缓存直接减少请求数，是提升最大的缓存策略`

怎么查看本地缓存？？？

火狐浏览器可查看缓存
about:cache?storage=disk
可以造成强制缓存的字段是 Cache-control 和 Expires

```nginx
    location / {
        root   /app/web;
        index  index.html index.htm;
        if ($request_filename ~ .*\.(css|js)$)
          {
              add_header Cache-Control   max-age=604800;
              add_header Cache-Control   public;
          }
    }
```

#### 协商缓存

当强制缓存失效（超过规定时间）时，就需要使用对比缓存，由服务器决定缓存内容是否失效。

流程上说，浏览器先请求缓存数据库，返回一个缓存标识，之后浏览器拿这个标识和服务器通讯。如果缓存未失效，则返回`HTTP状态码304`表示可以继续使用，于是客户端可以继续使用缓存。
如果失效，则返回新的数据和缓存规则，浏览器响应数据后，再把规则写入到缓存数据库。

`对比缓存在请求数上和没有缓存是一致的，但如果是 304 的话，返回的仅仅是一个状态码而已，并没有实际的文件内容，因此 在响应体体积上的节省是它的优化点。它的优化覆盖了文章开头提到过的请求数据的三个步骤中的最后一个：“响应”。通过减少响应体体积，来缩短网络传输时间。所以和强制缓存相比提升幅度较小，但总比没有缓存好。`

下面列举一些 Cache-control 字段常用的值
https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control(MDN)

| Cache-Control value 值 | 含义                                                                                 |
| ---------------------- | ------------------------------------------------------------------------------------ |
| max-age                | 最大有效时间                                                                         |
| must-revalidate        | 如果超过了 max-age 的时间，浏览器必须向服务器发送请求，验证资源是否还有效            |
| no-cache               | 客户端会缓存内容，但还是会向服务器发送请求，服务器返回 304，节省的是传输包大小的时间 |
| no-store               | 所有内容不走缓存                                                                     |
| public                 | 所有的内容都可以被缓存（包括客户端和代理服务器，如 CDN）                             |
| private                | 所有的内容只有客户端才可以缓存，代理服务器不能缓存                                   |
